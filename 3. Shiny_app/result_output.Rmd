---
title: "check"
author: "Glushkov Egor"
date: "`r Sys.Date()`"
output: html_document
---

```{r}
tmp_dt <- features[1:10, 1:2]
mean_train <- apply(tmp_dt, 2, mean, na.rm = TRUE)
sd_train <- apply(tmp_dt, 2, sd, na.rm = TRUE)
print(mean_train)
print(sd_train)
```


```{r}
features[11:20, c(2, 1)] %>% 
  .[, colnames(features[, 1:2])] %>% 
  scale(mean_train, sd_train)

features[11:20, 1:2] %>% scale(mean_train, sd_train)
```

```{r}
xx <- glm_pred - min(glm_pred)
xx / sum(xx)

mclust::softmax(glm_pred)
```

```{r}
riasec_codes <- c("R", "I", "A", "S", "E", "C")

code_desc <- data.table(
  riasec_codes = riasec_codes,
  desc = c(
    "R (Ð ÐµÐ°Ð»Ð¸ÑÑ‚Ð¸Ñ‡Ð½Ñ‹Ð¹).\nÐ›ÑŽÐ±Ð¸Ñ‚ Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÑƒÑŽ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ, Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ Ñ Ñ‚ÐµÑ…Ð½Ð¸ÐºÐ¾Ð¹ Ð¸ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸. ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹: Ð¸Ð½Ð¶ÐµÐ½ÐµÑ€ ðŸ› ï¸, Ð¼ÐµÑ…Ð°Ð½Ð¸Ðº, ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÐµÐ»ÑŒ.",
    "I (Ð˜ÑÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ð¹).\nÐ£Ð²Ð»ÐµÑ‡Ñ‘Ð½ Ð°Ð½Ð°Ð»Ð¸Ð·Ð¾Ð¼, Ð½Ð°ÑƒÐºÐ¾Ð¹ Ð¸ Ñ€ÐµÑˆÐµÐ½Ð¸ÐµÐ¼ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ñ… Ð·Ð°Ð´Ð°Ñ‡. ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹: ÑƒÑ‡Ñ‘Ð½Ñ‹Ð¹ ðŸ”¬, Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸ÑÑ‚, Ð±Ð¸Ð¾Ð»Ð¾Ð³.",
    "A (ÐÑ€Ñ‚Ð¸ÑÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹).\nÐ¢ÑÐ½ÐµÑ‚ÑÑ Ðº Ñ‚Ð²Ð¾Ñ€Ñ‡ÐµÑÑ‚Ð²Ñƒ, ÑÐ°Ð¼Ð¾Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸ÑŽ Ð¸ Ð½ÐµÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¼ Ñ€ÐµÑˆÐµÐ½Ð¸ÑÐ¼. ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹: Ð´Ð¸Ð·Ð°Ð¹Ð½ÐµÑ€ ðŸŽ¨, Ð¼ÑƒÐ·Ñ‹ÐºÐ°Ð½Ñ‚, Ð¿Ð¸ÑÐ°Ñ‚ÐµÐ»ÑŒ.",
    "S (Ð¡Ð¾Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹).\nÐÐ°Ñ…Ð¾Ð´Ð¸Ñ‚ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ Ð² Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸, Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ð¸ Ð¸ Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸ Ñ Ð»ÑŽÐ´ÑŒÐ¼Ð¸. ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹: ÑƒÑ‡Ð¸Ñ‚ÐµÐ»ÑŒ ðŸ“š, Ð¿ÑÐ¸Ñ…Ð¾Ð»Ð¾Ð³, ÑÐ¾Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ð½Ð¸Ðº.",
    "E (ÐŸÑ€ÐµÐ´Ð¿Ñ€Ð¸Ð¸Ð¼Ñ‡Ð¸Ð²Ñ‹Ð¹).\nÐ¡Ñ‚Ñ€ÐµÐ¼Ð¸Ñ‚ÑÑ Ðº Ð»Ð¸Ð´ÐµÑ€ÑÑ‚Ð²Ñƒ, Ð²Ð»Ð¸ÑÐ½Ð¸ÑŽ Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸ÑŽ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ð¼Ð¸. ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹: Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€ ðŸ’¼, Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑŒ, ÑŽÑ€Ð¸ÑÑ‚.",
    "C (ÐšÐ¾Ð½Ð²ÐµÐ½Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹).\nÐ¦ÐµÐ½Ð¸Ñ‚ Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº, ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸. ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹: Ð±ÑƒÑ…Ð³Ð°Ð»Ñ‚ÐµÑ€ ðŸ“Š, Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€, Ð°Ñ€Ñ…Ð¸Ð²Ð°Ñ€Ð¸ÑƒÑ."
    )
)
```


```{r}
make_conclusion <- function(pred_vec) {
  # GLOBAL: code_desc, riasec_codes
  res <- data.table(
    riasec_codes = riasec_codes,
    pred = pred_vec,
    conf_deg = (mclust::softmax(pred_vec) * 100) %>% as.vector() %>% round(1)
  ) %>% 
    .[, text := paste0(riasec_codes, " (", conf_deg, "%)")] %>% 
    merge(code_desc, by = "riasec_codes", all.x = TRUE) %>% 
    .[order(-pred)]
  
  pred_df <- rbind(pred_vec) %>% as.data.table() %>% rename_all(~riasec_codes)
  
  # print(pred_vec %>% `names<-`(riasec_codes))
  
  cat(
    pander::pandoc.table.return(pred_df, style = 'multiline'),
    "ÐšÐ¾Ð´Ñ‹ Ð“Ð¾Ð»Ð»Ð°Ð½Ð´Ð°:\n",
    " â€¢ ÐÐ°Ð¸Ð±Ð¾Ð»ÐµÐµ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ñ‹Ðµ: ", res[1:3, text] %>% paste0(collapse = ", "), "\n",
    " â€¢ ÐœÐµÐ½ÐµÐµ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ñ‹Ðµ: \t",  res[4:6, text] %>% paste0(collapse = ", "), "\n\n",
    "ÐžÐ±Ð¾Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ:\n",
    "X (Y%), Ð³Ð´Ðµ X - ÐºÐ¾Ð´ Ð“Ð¾Ð»Ð»Ð°Ð½Ð´Ð°, ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ Ñ‚Ð¸Ð¿Ñƒ Ð»Ð¸Ñ‡Ð½Ð¾ÑÑ‚Ð¸, Y - ÑÑ‚ÐµÐ¿ÐµÐ½ÑŒ ÑƒÐ²ÐµÑ€ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸, Ñ‡Ñ‚Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ð¹ ÐºÐ¾Ð´ Ð“Ð¾Ð»Ð»Ð°Ð½Ð´Ð° Ð²Ñ…Ð¾Ð´Ð¸Ñ‚ Ð² Ð²ÐµÑ€Ñ…Ð½ÑŽÑŽ Ñ‚Ñ€Ð¸Ð°Ð´Ñƒ\n\n",
    "Ð’Ð°ÑˆÐ¸ Ñ‚Ð¸Ð¿Ñ‹ Ð»Ð¸Ñ‡Ð½Ð¾ÑÑ‚Ð¸:\n",
    res[1:3, desc] %>% paste0(" â€¢ ", ., collapse = "\n\n")
  )
  return(invisible(NULL))
}
```

```{r}
make_conclusion(glm_pred)
```

