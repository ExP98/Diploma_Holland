
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(data.table)
library(jsonlite)
```

```{r}
data <- fread("D:/Programs/RProjects/Diploma_Holland/0. Data/AllTestsData_092024.csv")
```

```{r}
data[, .N, by = c("id")][order(-N)]
data[, .N, by = c("test_short_name")]
```

Обрабатывать по разным тестам данные отдельно. 
```{r}
data %>% 
    filter(test_short_name == "big_five") %>% 
    select(result) %>% 
    slice(1) %>% 
    pull()
```
Привязанность–обособленность -- согласие (конформность, agreebleness)
Экспрессивность–практичность --  открытость опыту (openness to experience)
Самоконтроль–импульсивность -- сознательность (conscientiousness)
Эмоциональная_устойчивость–эмоциональная_неустойчивость -- нейротизм (neuroticism)


```{r}
data %>% 
    pivot_wider(names_from = "test_short_name", values_from = result) %>% 
    filter(!is.na(golland_v2)) %>%
    select(id, golland, golland_v2) %>%
    view()

data %>% 
    pivot_wider(names_from = "test_short_name", values_from = result) %>% 
    view()
```


```{r}
s_cattel <- "[{A:6,C:13,E:15,F:18,G:10,H:14,I:9,L:11,M:10,N:11,O:13,Q1:12,Q2:11,Q3:8,Q4:10,B:6}]"
s_temperament <- "[{Экстраверсия:21,Психотизм:13,Нейротизм:25,Искренность:8}]"
s_leon <- "[{Г-1:21,Г-2:20,Г-3:15,Г-4:24,Г-5:21,Г-6:21,Г-7:18,Г-8:21,Г-9:12,Г-10:12}]"
s_bf <- "[{Экстраверсия–интроверсия:75,Привязанность–обособленность:75,Самоконтроль–импульсивность:75,Эмоциональная_устойчивость–эмоциональная_неустойчивость:74,Экспрессивность–практичность:75},{q_id:75,time:1646905559155,items:[{content:Зачем?,a_id:0}],state:accepted}]"

s_correct <- "[{\"Экстраверсия\":21,\"Психотизм\":13,\"Нейротизм\":25,\"Искренность\":8}]"
fromJSON(s_correct)
```

```{r}
s_leon %>% 
    str_replace_all("\\[\\{|\\}\\]", "") %>% 
    str_split(",") %>% 
    .[[1]] %>%
    str_split(":") %>% 
    sapply(\(elem) setNames(as.list(elem[[2]]), elem[[1]])) %>% 
    as.data.frame()
```

Превратить в единый датасет с извлеченными оценками по всем тестам
Проверить на пропуски
Проверить на выбросы по шкалам
Проверить на корреляции
Уменьшение размерности?
Метапеременные?
